# =============================================================================
# VYBZZ DOCKER COMPOSE - SSL CONFIGURATION
# =============================================================================
# This file extends docker-compose.yml to add SSL support
# 
# USAGE:
#   docker-compose -f docker-compose.yml -f docker-compose.ssl.yml up -d
#
# Or with production config:
#   docker-compose -f docker-compose.yml -f docker-compose.ssl.yml -f docker-compose.prod.yml --env-file .env.production up -d
#
# PREREQUISITES:
#   1. SSL certificates must be obtained first:
#      certbot certonly --standalone -d letsvybzz.com -d www.letsvybzz.com
#   
#   2. Certificates will be at:
#      /etc/letsencrypt/live/letsvybzz.com/fullchain.pem
#      /etc/letsencrypt/live/letsvybzz.com/privkey.pem
# =============================================================================

version: '3.8'

services:
  # ===========================================================================
  # FRONTEND SERVICE - SSL Configuration
  # ===========================================================================
  frontend:
    # Mount SSL certificates from host into container
    volumes:
      # SSL certificates directory (read-only for security)
      - /etc/letsencrypt:/etc/letsencrypt:ro
      
      # Optional: Mount custom nginx config if needed
      # - ./Frontend/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    
    # Expose both HTTP (80) and HTTPS (443) ports
    ports:
      - "80:80"      # HTTP (will redirect to HTTPS)
      - "443:443"    # HTTPS (main traffic)
    
    # Environment variables for SSL
    environment:
      - NGINX_HOST=letsvybzz.com
      - NGINX_PORT=443
    
    # Health check for HTTPS
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "https://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

# =============================================================================
# NOTES:
# =============================================================================
# 1. SSL Certificate Renewal:
#    Certificates expire after 90 days. Setup auto-renewal:
#    
#    sudo crontab -e
#    
#    Add this line:
#    0 0 1 * * certbot renew --quiet && docker-compose restart frontend
#
# 2. Testing SSL:
#    - Local: curl -I https://letsvybzz.com
#    - Online: https://www.ssllabs.com/ssltest/analyze.html?d=letsvybzz.com
#
# 3. Security Best Practices:
#    - Certificates are mounted read-only (:ro)
#    - HTTPS enforced via nginx redirect
#    - HSTS header enabled for security
#
# 4. Troubleshooting:
#    - Check nginx logs: docker-compose logs frontend
#    - Verify certificates: openssl x509 -in /etc/letsencrypt/live/letsvybzz.com/fullchain.pem -text -noout
#    - Test nginx config: docker exec frontend nginx -t
# =============================================================================

